-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://redmine.postgresql.org/projects/pgadmin4/issues/new if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public."CLINICAL_CENTERS"
(
    "CLINICAL_CENTER_CODE" character varying(3),
    "NAME" character varying(100) NOT NULL,
    "STREET" character varying(100) NOT NULL,
    "BUILDING_NUMBER" character varying(5) NOT NULL,
    "LOCALITY" character varying(100) NOT NULL,
    "POSTAL_CODE" character varying(6) NOT NULL,
    "VENUE_NUMBER" character varying(5),
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "CLCEN_PK" PRIMARY KEY ("CLINICAL_CENTER_CODE")
);

COMMENT ON TABLE public."CLINICAL_CENTERS"
    IS 'Short name: CLCEN';

CREATE TABLE IF NOT EXISTS public."CLINICAL_DIAGNOSES"
(
    "DIAGNOSIS_CODE" character varying(3),
    "NAME" character varying(200) NOT NULL,
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "CLDIAG_PK" PRIMARY KEY ("DIAGNOSIS_CODE")
);

COMMENT ON TABLE public."CLINICAL_DIAGNOSES"
    IS 'Short name: CLDIAG';

CREATE TABLE IF NOT EXISTS public."PATIENTS"
(
    "PATIENT_CODE" character varying(5),
    "INITIALS" character varying(4) NOT NULL,
    "BIRTH_DATE" date NOT NULL,
    "HOSPITALISATION_DATE" date NOT NULL,
    "CKRT_START_DATE" date NOT NULL,
    "LIVER_FAILURE" numeric(1) NOT NULL DEFAULT 0,
    "WEIGHT" numeric(5, 2) NOT NULL,
    "HEIGHT" numeric(3) NOT NULL,
    "CLINICAL_CENTER_CODE" character varying(5) NOT NULL,
    "DIAGNOSIS_CODE" character varying(3) NOT NULL,
    "DEATH_DATE" date,
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "PAT_PK" PRIMARY KEY ("PATIENT_CODE")
);

COMMENT ON TABLE public."PATIENTS"
    IS 'Short name: PAT';

CREATE TABLE IF NOT EXISTS public."PATIENTS_CLINICAL_DIAGNOSES"
(
    "PATIENT_CODE" character varying(5),
    "DIAGNOSIS_CODE" character varying(3),
    CONSTRAINT "PATCLDIAG_PK" PRIMARY KEY ("PATIENT_CODE", "DIAGNOSIS_CODE")
);

COMMENT ON TABLE public."PATIENTS_CLINICAL_DIAGNOSES"
    IS 'Short name PATCLDIAG';

CREATE TABLE IF NOT EXISTS public."CLINICAL_DATA"
(
    "PATIENT_CODE" character varying(5),
    "CLINICAL_DATA_TYPE_CODE" character varying(5),
    "CLINICAL_DATA_TYPE_DISCRIMINATOR" character varying(1),
    "DATA_COLLECTION_DATE" date,
    "DOCTOR_CODE" character varying(5) NOT NULL,
    "IS_DRAFT_VERSION" numeric(1) NOT NULL DEFAULT 0,
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "CLDA_PK" PRIMARY KEY ("PATIENT_CODE", "CLINICAL_DATA_TYPE_DISCRIMINATOR", "DATA_COLLECTION_DATE", "CLINICAL_DATA_TYPE_CODE")
);

COMMENT ON TABLE public."CLINICAL_DATA"
    IS 'Short name: CLDA';

CREATE TABLE IF NOT EXISTS public."DOCTORS"
(
    "DOCTOR_CODE" character varying(5),
    "FIRST_NAME" character varying(30) NOT NULL,
    "LAST_NAME" character varying(50) NOT NULL,
    "IS_DATA_ADMINISTRATOR" numeric(1) NOT NULL,
    "MIDDLE_NAME" character varying(30),
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "DOCT_PK" PRIMARY KEY ("DOCTOR_CODE")
);

COMMENT ON TABLE public."DOCTORS"
    IS 'Short name: DOCT';

CREATE TABLE IF NOT EXISTS public."TYPES"
(
    "TYPE_CODE" character varying(5),
    "TYPE_DISCRIMINATOR" character varying(1) NOT NULL,
    "NAME" character varying(100) NOT NULL,
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "TYP_PK" PRIMARY KEY ("TYPE_CODE", "TYPE_DISCRIMINATOR")
);

COMMENT ON TABLE public."TYPES"
    IS 'Short name: TYP';

CREATE TABLE IF NOT EXISTS public."PARAMETERS"
(
    "TYPE_CODE" character varying(5),
    "TYPE_DISCRIMINATOR" character varying(1),
    "PARAMETER_CODE" character varying(5),
    "NAME" character varying(100) NOT NULL,
    "DATA_TYPE" numeric(1) NOT NULL,
    "IS_PARAMETER_REGISTRATION_SUGGESTED" numeric(1) NOT NULL,
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "PRMS_PK" PRIMARY KEY ("TYPE_CODE", "TYPE_DISCRIMINATOR", "PARAMETER_CODE")
);

COMMENT ON TABLE public."PARAMETERS"
    IS 'Short name: PRMS';

CREATE TABLE IF NOT EXISTS public."PROCEDURES"
(
    "PATIENT_CODE" character varying(5),
    "PROCEDURE_TYPE_CODE" character varying(5),
    "PROCEDURE_TYPE_DISCRIMINATOR" character varying(1),
    "START_DATE" date,
    "CLINICAL_DATA_TYPE_CODE" character varying(5) NOT NULL,
    "CLINICAL_DATA_TYPE_DISCRIMINATOR" character varying(1) NOT NULL,
    "CLINICAL_DATA_COLLECTION_DATE" date NOT NULL,
    "IS_DRAFT_VERSION" numeric NOT NULL DEFAULT 0,
    "COMPLETION_REASON_CODE" character varying(4),
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "PROC_PK" PRIMARY KEY ("PATIENT_CODE", "PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_DISCRIMINATOR", "START_DATE")
);

COMMENT ON TABLE public."PROCEDURES"
    IS 'Short name: PROC';

CREATE TABLE IF NOT EXISTS public."CLINICAL_DATA_PARAMETERS_VALUES"
(
    "PATIENT_CODE" character varying(5),
    "CLINICAL_DATA_TYPE_CODE" character varying(5),
    "CLINICAL_DATA_TYPE_DISCRIMINATOR" character varying(1),
    "CLINICAL_DATA_COLLECTION_DATE" date,
    "PARAMETER_CODE" character varying(5),
    "NUMERIC_VALUE" numeric(6, 2),
    "TEXT_VALUE" character varying(100),
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "CLDA_PRMVAL" PRIMARY KEY ("PATIENT_CODE", "CLINICAL_DATA_TYPE_CODE", "CLINICAL_DATA_TYPE_DISCRIMINATOR", "CLINICAL_DATA_COLLECTION_DATE", "PARAMETER_CODE")
);

COMMENT ON TABLE public."CLINICAL_DATA_PARAMETERS_VALUES"
    IS 'CLDA_PRMVAL';

CREATE TABLE IF NOT EXISTS public."PROCEDURES_PARAMETERS_VALUES"
(
    "PATIENT_CODE" character varying(5),
    "PROCEDURE_TYPE_CODE" character varying(5),
    "PROCEDURE_TYPE_DISCRIMINATOR" character varying(1),
    "PROCEDURE_DATE" date,
    "PARAMETER_CODE" character varying(5),
    "NUMERIC_VALUE" numeric(6, 2),
    "TEXT_VALUE" character varying(100),
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "PROC_PRMVAL_PK" PRIMARY KEY ("PATIENT_CODE", "PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_DISCRIMINATOR", "PROCEDURE_DATE", "PARAMETER_CODE")
);

COMMENT ON TABLE public."PROCEDURES_PARAMETERS_VALUES"
    IS 'Short name: PROC_PRMVAL';

CREATE TABLE IF NOT EXISTS public."PROCEDURES_SESSIONS"
(
    "PATIENT_CODE" character varying(5),
    "PROCEDURE_TYPE_CODE" character varying(5),
    "PROCEDURE_TYPE_DISCRIMINATOR" character varying(1),
    "PROCEDURE_DATE" date,
    "SESSION_TYPE_CODE" character varying(5),
    "SESSION_TYPE_DISCRIMINATOR" character varying(1),
    "ORDINAL_NUMBER" numeric(3),
    "SESSION_START_DATE" date NOT NULL,
    "DOCTOR_CODE" character varying(5) NOT NULL,
    "IS_DRAFT_VERSION" numeric(1) NOT NULL DEFAULT 0,
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "PROCSES_PK" PRIMARY KEY ("PATIENT_CODE", "PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_DISCRIMINATOR", "PROCEDURE_DATE", "SESSION_TYPE_CODE", "SESSION_TYPE_DISCRIMINATOR", "ORDINAL_NUMBER")
);

COMMENT ON TABLE public."PROCEDURES_SESSIONS"
    IS 'Short name: PROCSES';

CREATE TABLE IF NOT EXISTS public."PROCEDURES_SESSIONS_PARAMETERS_VALUES"
(
    "PATIENT_CODE" character varying(5),
    "PROCEDURE_TYPE_CODE" character varying(5),
    "PROCEDURE_TYPE_DISCRIMINATOR" character varying(1),
    "PROCEDURE_START_DATE" date,
    "SESSION_TYPE_CODE" character varying(5),
    "SESSION_TYPE_DISCRIMINATOR" character varying(1),
    "SESSION_ORDINAL_NUMBER" numeric(3),
    "PARAMETER_CODE" character varying(5),
    "NUMERIC_VALUE" numeric(6, 2),
    "TEXT_VALUE" character varying(100),
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "PROCSES_PRMVAL_PK" PRIMARY KEY ("PATIENT_CODE", "PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_DISCRIMINATOR", "PROCEDURE_START_DATE", "SESSION_TYPE_CODE", "SESSION_TYPE_DISCRIMINATOR", "SESSION_ORDINAL_NUMBER", "PARAMETER_CODE")
);

COMMENT ON TABLE public."PROCEDURES_SESSIONS_PARAMETERS_VALUES"
    IS 'Short name: PROCSES_PRMVAL';

CREATE TABLE IF NOT EXISTS public."PROCEDURES_COMPLETIONS_REASONS"
(
    "REASON_CODE" character varying(4),
    "NAME" character varying(100) NOT NULL,
    "DESCRIPTION" character varying(1000),
    CONSTRAINT "PROCCOMR_PK" PRIMARY KEY ("REASON_CODE")
);

COMMENT ON TABLE public."PROCEDURES_COMPLETIONS_REASONS"
    IS 'Short name: PROCCOMR';

CREATE TABLE IF NOT EXISTS public."DOCTORS_PATIENTS"
(
    "DOCTOR_CODE" character varying(5),
    "PATIENT_CODE" character varying(5),
    CONSTRAINT "DOCTPAT_PK" PRIMARY KEY ("DOCTOR_CODE", "PATIENT_CODE")
);

COMMENT ON TABLE public."DOCTORS_PATIENTS"
    IS 'Short name: DOCTPAT';

ALTER TABLE IF EXISTS public."PATIENTS"
    ADD CONSTRAINT "PAT_CLCEN_FK" FOREIGN KEY ("CLINICAL_CENTER_CODE")
    REFERENCES public."CLINICAL_CENTERS" ("CLINICAL_CENTER_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PATIENTS"
    ADD CONSTRAINT "PAT_PATCLDIAG" FOREIGN KEY ("PATIENT_CODE", "DIAGNOSIS_CODE")
    REFERENCES public."PATIENTS_CLINICAL_DIAGNOSES" ("PATIENT_CODE", "DIAGNOSIS_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PATIENTS_CLINICAL_DIAGNOSES"
    ADD CONSTRAINT "PATCLDIAG_PAT_FK" FOREIGN KEY ("PATIENT_CODE")
    REFERENCES public."PATIENTS" ("PATIENT_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PATIENTS_CLINICAL_DIAGNOSES"
    ADD CONSTRAINT "PATCLDIAG_CLDIAG_FK" FOREIGN KEY ("DIAGNOSIS_CODE")
    REFERENCES public."CLINICAL_DIAGNOSES" ("DIAGNOSIS_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."CLINICAL_DATA"
    ADD CONSTRAINT "CLDA_PAT_FK" FOREIGN KEY ("PATIENT_CODE")
    REFERENCES public."PATIENTS" ("PATIENT_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."CLINICAL_DATA"
    ADD CONSTRAINT "CLDA_DOCT_FK" FOREIGN KEY ("DOCTOR_CODE")
    REFERENCES public."DOCTORS" ("DOCTOR_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."CLINICAL_DATA"
    ADD CONSTRAINT "CLDA_TYP_FK" FOREIGN KEY ("CLINICAL_DATA_TYPE_CODE", "CLINICAL_DATA_TYPE_DISCRIMINATOR")
    REFERENCES public."TYPES" ("TYPE_CODE", "TYPE_DISCRIMINATOR") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PARAMETERS"
    ADD CONSTRAINT "PRMS_TYP_FK" FOREIGN KEY ("TYPE_CODE", "TYPE_DISCRIMINATOR")
    REFERENCES public."TYPES" ("TYPE_CODE", "TYPE_DISCRIMINATOR") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PROCEDURES"
    ADD CONSTRAINT "PROC_CLDA_FK" FOREIGN KEY ("PATIENT_CODE", "CLINICAL_DATA_TYPE_CODE", "CLINICAL_DATA_TYPE_DISCRIMINATOR", "CLINICAL_DATA_COLLECTION_DATE")
    REFERENCES public."CLINICAL_DATA" ("PATIENT_CODE", "CLINICAL_DATA_TYPE_CODE", "CLINICAL_DATA_TYPE_DISCRIMINATOR", "DATA_COLLECTION_DATE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PROCEDURES"
    ADD CONSTRAINT "PROC_TYP_FK" FOREIGN KEY ("PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_DISCRIMINATOR")
    REFERENCES public."TYPES" ("TYPE_CODE", "TYPE_DISCRIMINATOR") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PROCEDURES"
    ADD CONSTRAINT "PROC_PROCCOMR_FK" FOREIGN KEY ("COMPLETION_REASON_CODE")
    REFERENCES public."PROCEDURES_COMPLETIONS_REASONS" ("REASON_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."CLINICAL_DATA_PARAMETERS_VALUES"
    ADD CONSTRAINT "CLDA_PRMVAL_CLDA_FK" FOREIGN KEY ("PATIENT_CODE", "CLINICAL_DATA_TYPE_CODE", "CLINICAL_DATA_TYPE_DISCRIMINATOR", "CLINICAL_DATA_COLLECTION_DATE")
    REFERENCES public."CLINICAL_DATA" ("PATIENT_CODE", "CLINICAL_DATA_TYPE_CODE", "CLINICAL_DATA_TYPE_DISCRIMINATOR", "DATA_COLLECTION_DATE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."CLINICAL_DATA_PARAMETERS_VALUES"
    ADD CONSTRAINT "CLDA_PRMVAL_PRMS_FK" FOREIGN KEY ("CLINICAL_DATA_TYPE_CODE", "CLINICAL_DATA_TYPE_DISCRIMINATOR", "PARAMETER_CODE")
    REFERENCES public."PARAMETERS" ("TYPE_CODE", "TYPE_DISCRIMINATOR", "PARAMETER_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PROCEDURES_PARAMETERS_VALUES"
    ADD CONSTRAINT "PROC_PRMVAL_PROC_FK" FOREIGN KEY ("PATIENT_CODE", "PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_DISCRIMINATOR", "PROCEDURE_DATE")
    REFERENCES public."PROCEDURES" ("PATIENT_CODE", "PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_DISCRIMINATOR", "START_DATE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PROCEDURES_PARAMETERS_VALUES"
    ADD CONSTRAINT "PROC_PRMVAL_PRMS_FK" FOREIGN KEY ("PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_CODE", "PARAMETER_CODE")
    REFERENCES public."PARAMETERS" ("TYPE_CODE", "TYPE_DISCRIMINATOR", "PARAMETER_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PROCEDURES_SESSIONS"
    ADD CONSTRAINT "PROCSES_PROC_FK" FOREIGN KEY ("PATIENT_CODE", "PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_DISCRIMINATOR", "PROCEDURE_DATE")
    REFERENCES public."PROCEDURES" ("PATIENT_CODE", "PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_DISCRIMINATOR", "START_DATE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PROCEDURES_SESSIONS"
    ADD CONSTRAINT "PROCSES_DOCT_FK" FOREIGN KEY ("DOCTOR_CODE")
    REFERENCES public."DOCTORS" ("DOCTOR_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PROCEDURES_SESSIONS"
    ADD CONSTRAINT "PROCSES_TYP_FK" FOREIGN KEY ("SESSION_TYPE_CODE", "SESSION_TYPE_DISCRIMINATOR")
    REFERENCES public."TYPES" ("TYPE_CODE", "TYPE_DISCRIMINATOR") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PROCEDURES_SESSIONS_PARAMETERS_VALUES"
    ADD CONSTRAINT "PROCSES_PRMVAL_PROCSES_FK" FOREIGN KEY ("PATIENT_CODE", "PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_DISCRIMINATOR", "PROCEDURE_START_DATE", "SESSION_TYPE_CODE", "SESSION_TYPE_DISCRIMINATOR", "SESSION_ORDINAL_NUMBER")
    REFERENCES public."PROCEDURES_SESSIONS" ("PATIENT_CODE", "PROCEDURE_TYPE_CODE", "PROCEDURE_TYPE_DISCRIMINATOR", "PROCEDURE_DATE", "SESSION_TYPE_CODE", "SESSION_TYPE_DISCRIMINATOR", "ORDINAL_NUMBER") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."PROCEDURES_SESSIONS_PARAMETERS_VALUES"
    ADD CONSTRAINT "PROCSES_PRMVAL_PRMS_FK" FOREIGN KEY ("SESSION_TYPE_CODE", "SESSION_TYPE_DISCRIMINATOR", "PARAMETER_CODE")
    REFERENCES public."PARAMETERS" ("TYPE_CODE", "TYPE_DISCRIMINATOR", "PARAMETER_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."DOCTORS_PATIENTS"
    ADD CONSTRAINT "DOCTPAT_DOCT_FK" FOREIGN KEY ("DOCTOR_CODE")
    REFERENCES public."DOCTORS" ("DOCTOR_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS public."DOCTORS_PATIENTS"
    ADD CONSTRAINT "DOCTPAT_PAT_FK" FOREIGN KEY ("PATIENT_CODE")
    REFERENCES public."PATIENTS" ("PATIENT_CODE") MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;

END;